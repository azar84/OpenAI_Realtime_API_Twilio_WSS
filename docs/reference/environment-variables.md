# Environment Variables Reference

This document provides a comprehensive reference for all environment variables used in the OpenAI Realtime + Twilio Demo system.

## 🌐 WebSocket Server Environment Variables

**File:** `websocket-server/.env`

### Required Variables

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `OPENAI_API_KEY` | OpenAI API key for Realtime API access | `sk-proj-...` | ✅ |
| `DB_HOST` | PostgreSQL database host | `localhost` | ✅ |
| `DB_PORT` | PostgreSQL database port | `5432` | ✅ |
| `DB_NAME` | PostgreSQL database name | `openai_realtime_db` | ✅ |
| `DB_USER` | PostgreSQL database username | `postgres` | ✅ |
| `DB_PASSWORD` | PostgreSQL database password | `your_password` | ✅ |

### Optional Variables

| Variable | Description | Default | Example |
|----------|-------------|---------|---------|
| `PORT` | WebSocket server port | `8081` | `8081` |
| `NODE_ENV` | Node.js environment | `development` | `production` |
| `PUBLIC_URL` | Public URL for Twilio webhooks | `""` | `https://abc123.ngrok-free.app` |
| `DEBUG` | Enable debug logging | `false` | `true` |

### Tool Integration Variables

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `N8N_TOOL_URL` | n8n webhook URL for tools | `https://n8n.example.com/webhook/tools` | ❌ |
| `N8N_SECRET` | n8n webhook secret for authentication | `your-secret-key` | ❌ |

### Example Configuration

```env
# OpenAI Configuration
OPENAI_API_KEY=sk-proj-your-openai-api-key-here

# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_NAME=openai_realtime_db
DB_USER=postgres
DB_PASSWORD=your_password

# Server Configuration
PORT=8081
NODE_ENV=development
PUBLIC_URL=https://abc123.ngrok-free.app

# Debug Configuration
DEBUG=true

# Tool Integration
N8N_TOOL_URL=https://n8n.example.com/webhook/tools
N8N_SECRET=your-n8n-secret
```

## 🌐 Web Application Environment Variables

**File:** `webapp/.env`

### Required Variables

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `TWILIO_ACCOUNT_SID` | Twilio Account SID | `AC1234567890abcdef` | ✅ |
| `TWILIO_AUTH_TOKEN` | Twilio Auth Token | `your_auth_token` | ✅ |

### Optional Variables

| Variable | Description | Default | Example |
|----------|-------------|---------|---------|
| `DB_HOST` | PostgreSQL database host | `localhost` | `localhost` |
| `DB_PORT` | PostgreSQL database port | `5432` | `5432` |
| `DB_NAME` | PostgreSQL database name | `openai_realtime_db` | `openai_realtime_db` |
| `DB_USER` | PostgreSQL database username | `postgres` | `postgres` |
| `DB_PASSWORD` | PostgreSQL database password | `""` | `your_password` |
| `NEXT_PUBLIC_WS_URL` | WebSocket server URL | `ws://localhost:8081` | `ws://localhost:8081` |

### Auto-generated Variables

These variables are automatically generated by the startup script:

| Variable | Description | Example |
|----------|-------------|---------|
| `NGROK_URL` | Current ngrok HTTPS URL | `https://abc123.ngrok-free.app` |
| `NGROK_WS_URL` | Current ngrok WebSocket URL | `wss://abc123.ngrok-free.app` |
| `NGROK_HTTPS_URL` | Current ngrok HTTPS URL (alias) | `https://abc123.ngrok-free.app` |

### Example Configuration

```env
# Twilio Configuration
TWILIO_ACCOUNT_SID=AC1234567890abcdef
TWILIO_AUTH_TOKEN=your_auth_token

# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_NAME=openai_realtime_db
DB_USER=postgres
DB_PASSWORD=your_password

# WebSocket Configuration
NEXT_PUBLIC_WS_URL=ws://localhost:8081

# Auto-generated ngrok URLs (for reference)
NGROK_URL=https://abc123.ngrok-free.app
NGROK_WS_URL=wss://abc123.ngrok-free.app
NGROK_HTTPS_URL=https://abc123.ngrok-free.app
```

## 🔧 Development Environment Variables

### Local Development

**WebSocket Server:**
```env
# Development settings
NODE_ENV=development
DEBUG=true
PORT=8081

# Local database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=openai_realtime_db
DB_USER=postgres
DB_PASSWORD=your_password

# OpenAI API
OPENAI_API_KEY=sk-proj-your-openai-api-key-here

# ngrok will be set automatically
PUBLIC_URL=
```

**Web Application:**
```env
# Development settings
NODE_ENV=development

# Twilio credentials
TWILIO_ACCOUNT_SID=AC1234567890abcdef
TWILIO_AUTH_TOKEN=your_auth_token

# Local database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=openai_realtime_db
DB_USER=postgres
DB_PASSWORD=your_password

# Local WebSocket
NEXT_PUBLIC_WS_URL=ws://localhost:8081
```

### Production Environment

**WebSocket Server:**
```env
# Production settings
NODE_ENV=production
DEBUG=false
PORT=8081

# Production database
DB_HOST=your-db-host.com
DB_PORT=5432
DB_NAME=openai_realtime_db
DB_USER=production_user
DB_PASSWORD=secure_password

# OpenAI API
OPENAI_API_KEY=sk-proj-your-openai-api-key-here

# Production domain
PUBLIC_URL=https://your-domain.com

# Tool integration
N8N_TOOL_URL=https://n8n.your-domain.com/webhook/tools
N8N_SECRET=your-production-secret
```

**Web Application:**
```env
# Production settings
NODE_ENV=production

# Twilio credentials
TWILIO_ACCOUNT_SID=AC1234567890abcdef
TWILIO_AUTH_TOKEN=your_auth_token

# Production database
DB_HOST=your-db-host.com
DB_PORT=5432
DB_NAME=openai_realtime_db
DB_USER=production_user
DB_PASSWORD=secure_password

# Production WebSocket
NEXT_PUBLIC_WS_URL=wss://your-domain.com
```

## 🔐 Security Considerations

### Sensitive Variables

**Never commit these to version control:**
- `OPENAI_API_KEY`
- `TWILIO_AUTH_TOKEN`
- `DB_PASSWORD`
- `N8N_SECRET`

**Use .env files:**
```bash
# Add to .gitignore
echo ".env" >> .gitignore
echo "*.env" >> .gitignore
```

**Use environment-specific files:**
- `.env.development`
- `.env.production`
- `.env.local`

### Environment Variable Validation

**WebSocket Server:**
```typescript
// Validate required environment variables
const requiredVars = [
  'OPENAI_API_KEY',
  'DB_HOST',
  'DB_PORT',
  'DB_NAME',
  'DB_USER',
  'DB_PASSWORD'
];

for (const varName of requiredVars) {
  if (!process.env[varName]) {
    console.error(`Missing required environment variable: ${varName}`);
    process.exit(1);
  }
}
```

**Web Application:**
```typescript
// Validate required environment variables
const requiredVars = [
  'TWILIO_ACCOUNT_SID',
  'TWILIO_AUTH_TOKEN'
];

for (const varName of requiredVars) {
  if (!process.env[varName]) {
    console.error(`Missing required environment variable: ${varName}`);
    process.exit(1);
  }
}
```

## 🚀 Deployment Environment Variables

### Docker Environment

**docker-compose.yml:**
```yaml
version: '3.8'
services:
  websocket-server:
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=openai_realtime_db
      - DB_USER=postgres
      - DB_PASSWORD=${DB_PASSWORD}
      - PORT=8081
      - NODE_ENV=production
      - PUBLIC_URL=${PUBLIC_URL}
  
  webapp:
    environment:
      - TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}
      - TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=openai_realtime_db
      - DB_USER=postgres
      - DB_PASSWORD=${DB_PASSWORD}
      - NEXT_PUBLIC_WS_URL=ws://websocket-server:8081
```

### Cloud Environment

**Environment-specific configuration:**

**Heroku:**
```bash
# Set environment variables
heroku config:set OPENAI_API_KEY=sk-proj-...
heroku config:set TWILIO_ACCOUNT_SID=AC1234567890abcdef
heroku config:set TWILIO_AUTH_TOKEN=your_auth_token
heroku config:set DB_HOST=your-db-host.com
heroku config:set DB_PASSWORD=secure_password
```

**Vercel:**
```bash
# Set environment variables
vercel env add OPENAI_API_KEY
vercel env add TWILIO_ACCOUNT_SID
vercel env add TWILIO_AUTH_TOKEN
vercel env add DB_HOST
vercel env add DB_PASSWORD
```

**AWS:**
```bash
# Set environment variables
aws ssm put-parameter --name "/app/openai-api-key" --value "sk-proj-..." --type "SecureString"
aws ssm put-parameter --name "/app/twilio-account-sid" --value "AC1234567890abcdef" --type "SecureString"
aws ssm put-parameter --name "/app/twilio-auth-token" --value "your_auth_token" --type "SecureString"
```

## 🔍 Environment Variable Debugging

### Check Current Variables

**WebSocket Server:**
```bash
# Check all environment variables
cd websocket-server
node -e "console.log(process.env)"

# Check specific variables
node -e "console.log('OPENAI_API_KEY:', process.env.OPENAI_API_KEY ? 'SET' : 'NOT SET')"
node -e "console.log('DB_HOST:', process.env.DB_HOST)"
```

**Web Application:**
```bash
# Check all environment variables
cd webapp
node -e "console.log(process.env)"

# Check specific variables
node -e "console.log('TWILIO_ACCOUNT_SID:', process.env.TWILIO_ACCOUNT_SID ? 'SET' : 'NOT SET')"
node -e "console.log('TWILIO_AUTH_TOKEN:', process.env.TWILIO_AUTH_TOKEN ? 'SET' : 'NOT SET')"
```

### Environment Variable Loading

**Check .env file loading:**
```typescript
// In websocket-server/src/server.ts
import dotenv from 'dotenv';

// Load .env file
const result = dotenv.config();

if (result.error) {
  console.error('Error loading .env file:', result.error);
} else {
  console.log('Environment variables loaded from .env file');
}
```

**Validate environment on startup:**
```typescript
// Validate environment variables
const validateEnvironment = () => {
  const required = ['OPENAI_API_KEY', 'DB_HOST', 'DB_PORT', 'DB_NAME', 'DB_USER', 'DB_PASSWORD'];
  const missing = required.filter(key => !process.env[key]);
  
  if (missing.length > 0) {
    console.error('Missing required environment variables:', missing);
    process.exit(1);
  }
  
  console.log('✅ All required environment variables are set');
};

validateEnvironment();
```

## 📊 Environment Variable Monitoring

### Health Check Endpoint

**WebSocket Server:**
```typescript
app.get('/health', (req, res) => {
  const health = {
    status: 'healthy',
    timestamp: new Date().toISOString(),
    environment: {
      nodeEnv: process.env.NODE_ENV,
      port: process.env.PORT,
      hasOpenAIKey: !!process.env.OPENAI_API_KEY,
      hasDbConfig: !!(process.env.DB_HOST && process.env.DB_NAME),
      hasPublicUrl: !!process.env.PUBLIC_URL
    }
  };
  
  res.json(health);
});
```

**Web Application:**
```typescript
// app/api/health/route.ts
export async function GET() {
  const health = {
    status: 'healthy',
    timestamp: new Date().toISOString(),
    environment: {
      nodeEnv: process.env.NODE_ENV,
      hasTwilioConfig: !!(process.env.TWILIO_ACCOUNT_SID && process.env.TWILIO_AUTH_TOKEN),
      hasDbConfig: !!(process.env.DB_HOST && process.env.DB_NAME),
      wsUrl: process.env.NEXT_PUBLIC_WS_URL
    }
  };
  
  return Response.json(health);
}
```

### Environment Variable Logging

**Safe logging (hide sensitive values):**
```typescript
const logEnvironment = () => {
  const env = {
    NODE_ENV: process.env.NODE_ENV,
    PORT: process.env.PORT,
    DB_HOST: process.env.DB_HOST,
    DB_PORT: process.env.DB_PORT,
    DB_NAME: process.env.DB_NAME,
    DB_USER: process.env.DB_USER,
    DB_PASSWORD: process.env.DB_PASSWORD ? '***' : 'NOT SET',
    OPENAI_API_KEY: process.env.OPENAI_API_KEY ? '***' : 'NOT SET',
    TWILIO_ACCOUNT_SID: process.env.TWILIO_ACCOUNT_SID ? '***' : 'NOT SET',
    TWILIO_AUTH_TOKEN: process.env.TWILIO_AUTH_TOKEN ? '***' : 'NOT SET',
    PUBLIC_URL: process.env.PUBLIC_URL
  };
  
  console.log('Environment configuration:', env);
};
```

This comprehensive reference should help you properly configure and manage environment variables across all deployment scenarios.
